@using RZ.Foundation.BlazorViews.Shells
@using Microsoft.AspNetCore.Components.Sections
@using RZ.Foundation.Blazor
@using RZ.Foundation.Blazor.Helpers
@inherits ReactiveInjectableComponentBase<ShellViewModel>

@inject IServiceProvider ServiceProvider
@inject NavigationManager NavManager
@inject ShellViewModel Shell

<MudThemeProvider Theme="Theme" @bind-IsDarkMode="ViewModel!.IsDarkMode" />
<MudPopoverProvider />
<MudDialogProvider BackdropClick="false" NoHeader="true" />
<MudSnackbarProvider />

<MudLayout Class="screen-height">
    <ShellAppBar ViewModel="ViewModel" />
    <ShellNavMenu ViewModel="menuVm" />
    <MudMainContent Class="max-height">
        <SectionOutlet SectionName="content-top"/>

        <MudContainer MaxWidth="@(MaxWidth ?? MudBlazor.MaxWidth.False)" Class="max-height">
            <ShellViewContent ViewModel="ViewModel!"/>
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {

    [Parameter] public MudTheme? Theme { get; set; }
    [Parameter] public MaxWidth? MaxWidth { get; set; }

    ShellNavMenuViewModel menuVm = default!;

    protected override void OnParametersSet() {
        menuVm = new(Shell);
        Shell.NavigateTo(NavManager.Path());
        base.OnParametersSet();
    }
}
